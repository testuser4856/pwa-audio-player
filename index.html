<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>PWA Audio â€“ Stable</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#0b0b0b" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <style>
    :root { font-family: system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans JP',sans-serif; }
    body { margin:0; background:#0b0b0b; color:#e5e7eb; }
    .btn { background:#1f2937; border:1px solid #2a2a2a; color:#e5e7eb; border-radius:12px; padding:8px 10px; }
    .muted { color:#94a3b8; font-size:12px; }
    .row { display:flex; gap:8px; align-items:center; }
    .topbar { display:flex; gap:8px; align-items:center; justify-content:space-between; padding:10px; }

    .title { font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .seek { width:100%; appearance:none; height:4px; border-radius:999px; background:#2a2a2a; }
    .controls { display:flex; gap:10px; align-items:center; }
    .sheet { position: fixed; inset:0; background:rgba(0,0,0,.5); display:none; }
    .panel { position:absolute; left:0; right:0; bottom:0; max-height:74vh; overflow:auto; background:#0e0e0e;
             border-top-left-radius:16px; border-top-right-radius:16px; padding:12px; border-top:1px solid #222; }
    .list { width:100%; height:40vh; background:#111; border:1px solid #222; border-radius:12px; color:#e5e7eb; }

    /* ãƒŸãƒ‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å·¦å³é…ç½®ï¼šå·¦=controls / å³=info */
    .mini {
      display: grid;
      grid-template-columns: auto 1fr;
      grid-template-areas: "controls info";
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }
    .controls { grid-area: controls; display: flex; gap: 8px; align-items: center; }
    #info     { grid-area: info;   min-width: 0; } /* ã“ã‚Œã§ã‚¿ã‚¤ãƒˆãƒ«çœç•¥ãŒåŠ¹ã */
    
    /* ã‚¿ã‚¤ãƒˆãƒ«ã¯å¸¸ã«çœç•¥è¡¨ç¤ºï¼ˆãƒœã‚¿ãƒ³ãŒæŠ¼ã—å‡ºã•ã‚Œãªã„ï¼‰ */
    .title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    
    /* iOSã®ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ å¯¾ç­–ï¼šãƒœã‚¿ãƒ³ã¯16pxä»¥ä¸Šï¼†manipulation */
    .btn {
      font-size: 16px;                 /* 16pxæœªæº€ã ã¨iOSãŒã‚ºãƒ¼ãƒ ã—ãŒã¡ */
      touch-action: manipulation;      /* ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ ã®æŠ‘åˆ¶ã«åŠ¹ã */
      -webkit-user-select: none;
      user-select: none;
    }
    
    /* ã™ã”ãç‹­ã„å¹…ã§ã®è©°ã‚èª¿æ•´ */
    @media (max-width: 380px) {
      .controls { gap: 6px; }
      .btn { padding: 6px 8px; border-radius: 10px; }
      .mini { padding: 8px 10px; }
    }

    
    /* ã‚¿ãƒƒãƒ—ã§ä¸€æ™‚çš„ã«å‡ºã™â€œãƒãƒƒãƒ—è¡¨ç¤ºâ€ */
    .title-peek {
      position: fixed;
      left: 12px; right: 12px;
      bottom: calc(72px + env(safe-area-inset-bottom)); /* ãƒŸãƒ‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å°‘ã—ä¸Š */
      max-width: calc(100vw - 24px);
      background: rgba(20,20,20,.96);
      border: 1px solid #2a2a2a;
      color: #e5e7eb;
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: 0 6px 24px rgba(0,0,0,.35);
      z-index: 9999;
      font-size: 14px;
      line-height: 1.4;
      pointer-events: none; /* ã‚¿ãƒƒãƒ—ã¯ä¸‹ã«é€šã™ï¼çœé›»åŠ›ï¼†ç°¡å˜ */

      .listbox {
        display: grid;
        grid-auto-rows: minmax(36px, auto);
        overflow: auto;
        padding: 6px;
        gap: 4px;
      }
      
      .listitem {
        padding: 8px 10px;
        border: 1px solid #2a2a2a;
        border-radius: 10px;
        background: #141414;
        cursor: pointer;
        user-select: none;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .listitem.selected {
        background: #1f2937;
        border-color: #3a3a3a;
      }

    }
        
    /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¯ç¸®ã¾ã›ãªã„ï¼ˆæŠ¼ã—å‡ºã•ã‚Œãªã„ï¼‰ */
    .controls { flex: 0 0 auto; }
    
    /* ç”»é¢ãŒç‹­ã„æ™‚ã¯ãƒœã‚¿ãƒ³é–“éš”ã¨ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è©°ã‚ã‚‹ */
    @media (max-width: 380px) {
      .controls { gap: 6px; }
      .btn { padding: 6px 8px; border-radius: 10px; }
      .mini { padding: 8px 10px; }
    }
    .badge{
      display:inline-block; padding:4px 8px; border-radius:999px;
      font-size:12px; line-height:1; border:1px solid #2a2a2a;
      background:#141414; color:#e5e7eb;
    }
    .badge.online{ background:#0b3d1a; border-color:#0f5132; color:#b6f2c4; }  /* ç·‘ç³» */
    .badge.offline{ background:#3a1414; border-color:#6b1b1b; color:#ffc2c2; } /* èµ¤ç³» */
    .badge.pwa::after{ content:" â€¢ PWA"; opacity:.7; }
    
    .toast{
      position: fixed; left:12px; right:12px; top:12px; z-index:9999;
      background: rgba(20,20,20,.96); color:#e5e7eb; border:1px solid #2a2a2a;
      padding:10px 12px; border-radius:12px; box-shadow:0 6px 24px rgba(0,0,0,.35);
      text-align:center; pointer-events:none;
    }
    /* æ—¢å®šï¼ˆPCãªã©åºƒã„ç”»é¢ï¼‰ï¼šå·¦=controls / å³=info */
    .mini {
      display: grid;
      grid-template-columns: auto 1fr;
      grid-template-areas: "controls info";
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }
    .controls { grid-area: controls; display: flex; gap: 8px; align-items: center; }
    #info     { grid-area: info;   min-width: 0; } /* ã‚¿ã‚¤ãƒˆãƒ«çœç•¥ã«å¿…é ˆ */
    .title    { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    
    /* â–¼ ç‹­ã„ç”»é¢ï¼ˆ= iPhoneæƒ³å®šï¼‰ã¯ä¸Šä¸‹2æ®µï¼šä¸Š=info / ä¸‹=controls */
    @media (max-width: 480px) {
      .mini {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto;
        grid-template-areas:
          "info"
          "controls";
        align-items: stretch;
      }
      #info { min-width: 0; }
      .controls {
        justify-content: space-between;
        flex-wrap: wrap;          /* ãƒœã‚¿ãƒ³ãŒå¤šãã¦ã‚‚æŠ˜ã‚Šè¿”ã—ã¦å…¥ã‚‹ */
        gap: 6px;
      }
      .btn {                      /* èª¤ã‚ºãƒ¼ãƒ æŠ‘åˆ¶ã—ã¤ã¤å°‘ã—å°ã•ã‚ã« */
        font-size: 16px;
        padding: 6px 8px;
        border-radius: 10px;
        touch-action: manipulation;
      }
      .seek { margin-top: 4px; }  /* ã‚¿ã‚¤ãƒˆãƒ«ç›´ä¸‹ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã«å°‘ã—ä½™ç™½ */
    }
    
    /* iOSå°‚ç”¨ã®å¾®èª¿æ•´ï¼ˆSafariåˆ¤å®šã«åŠ¹ãã‚„ã¤ï¼‰ */
    @supports (-webkit-touch-callout: none) {
      .mini { padding-bottom: calc(12px + env(safe-area-inset-bottom)); }
    }
    .controls { overflow-x: auto; -webkit-overflow-scrolling: touch; }

      </style>
    </head>
    <body>
  <div class="topbar">
    <button id="openLib" class="btn">ãƒ©ã‚¤ãƒ–ãƒ©ãƒª/PL</button>
    <div class="row" style="gap:10px; align-items:center">
      <span id="netBadge" class="badge">Checkingâ€¦</span>
      <span id="rateLabel" class="muted">1.0x</span>
    </div>
  </div>

<!-- ç”»é¢ä¸Šéƒ¨ã«ä¸€æ™‚è¡¨ç¤ºã™ã‚‹ãƒˆãƒ¼ã‚¹ãƒˆ -->
<div id="netToast" class="toast" hidden></div>

  <div class="mini">
    <!-- æƒ…å ±ï¼ˆã‚¿ã‚¤ãƒˆãƒ«/ã‚·ãƒ¼ã‚¯ï¼‰ãƒ–ãƒ­ãƒƒã‚¯ã«IDä»˜ä¸ -->
    <div id="info">
      <div id="title" class="title">ï¼ˆæœªé¸æŠï¼‰</div>
      <input id="seek" class="seek" type="range" min="0" max="1" value="0" step="0.001" />
      <div class="row" style="justify-content:space-between">
        <span id="cur" class="muted">00:00</span>
        <span id="dur" class="muted">00:00</span>
      </div>
    </div>
  
    <!-- ãƒœã‚¿ãƒ³ç¾¤ï¼ˆ10ç§’ï¼‹60ç§’ï¼‰ -->
    <div class="controls">
      <button id="back60" class="btn">âª 60s</button>
      <button id="back10" class="btn">âª 10s</button>
      <button id="prev"   class="btn">â®</button>
      <button id="play"   class="btn">â–¶ï¸</button>
      <button id="next"   class="btn">â­</button>
      <button id="fwd10"  class="btn">10s â©</button>
      <button id="fwd60"  class="btn">60s â©</button>
    </div>
  </div>

  <div id="titlePeek" class="title-peek" hidden></div>

  <!-- ãƒ©ã‚¤ãƒ–ãƒ©ãƒª/ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚·ãƒ¼ãƒˆ -->
  <div id="sheet" class="sheet" aria-hidden="true">
    <div class="panel">
      <div class="row" style="justify-content:space-between; margin-bottom:8px">
        <strong>ãƒ©ã‚¤ãƒ–ãƒ©ãƒª & ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ!</strong>
        <button id="closeLib" class="btn">é–‰ã˜ã‚‹</button>
      </div>

      <div class="row" style="margin-bottom:8px">
        <select id="playlist" class="btn" style="flex:1"></select>
        <button id="newPl" class="btn">ï¼‹æ–°è¦</button>
        <button id="renPl" class="btn">æ”¹å</button>
        <button id="delPl" class="btn">å‰Šé™¤</button>
      </div>

      <div class="row" style="margin-bottom:8px">
        <label class="btn" for="picker">ï¼‹å–ã‚Šè¾¼ã¿</label>
        <input id="picker" type="file" multiple accept=".mp3,.m4a,.aac,.wav,.m4b,audio/*">
        <select id="sort" class="btn">
          <option value="nameAsc">åå‰Aâ†’Z</option>
          <option value="addedDesc">æ–°ã—ã„é †</option>
        </select>
      </div>

      <select id="tracks" class="list" size="10"></select>
      <!-- è¿½åŠ ï¼šiOSç”¨ã®æ“¬ä¼¼ãƒªã‚¹ãƒˆï¼ˆå¸¸æ™‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤ºï¼‰ -->
      <div id="tracksList" class="list listbox" role="listbox" hidden></div>

      <div class="row" style="margin-top:8px; justify-content:flex-end">
        <button id="up" class="btn">â–²</button>
        <button id="down" class="btn">â–¼</button>
        <button id="rm" class="btn">ğŸ—‘ï¼ˆPLã‹ã‚‰å¤–ã™ï¼‰</button>
        <button id="rmLib" class="btn">ğŸ§¹ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰å‰Šé™¤</button>
        <button id="playSel" class="btn">ã“ã®æ›²ã‚’å†ç”Ÿ</button>
      </div>

      <div class="row" style="margin-top:8px; justify-content:space-between">
        <span class="muted">â€» å…¨æ¶ˆã—ã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“</span>
        <button id="nuke" class="btn" style="background:#7f1d1d;border-color:#7f1d1d">âš  å…¨ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–</button>
      </div>
    </div>
  </div>

  <audio id="audio" preload="auto" playsinline></audio>
  <script src="./app.js"></script>
  <script> if ('serviceWorker' in navigator) addEventListener('load',()=>navigator.serviceWorker.register('./sw.js')); </script>
</body>
</html>
